<h1 align="center">查询语句</h1>

**接口：`10.60.150.24:31119/api/v1/query?query=`**

> 此表中所有查询语句中的`job`指定字段在我们的机器中都是可删除的，因为就这一个job。如果有多个job，那么可以指定其中一个，或加`sum by (job)`字段计算总和。
>
> 此表中所有查询语句的`instance`和`node`字段都是一样的，因为我们的集群中instance和node一对一。一个node代表一个物理机。
>
> 查询语句中container和node不一样，container指pod，即一组协同调度的docker。container相关查询我还没有整理好。

```javascript
(1 - avg by (instance) (irate(node_cpu_seconds_total{job='kubernetes-node-exporter',mode="idle"}[5m])))
三台机器 CPU使用率
```

```javascript
node_load1{job='kubernetes-node-exporter'}
三台机器 1分钟内负载
node_load5{job='kubernetes-node-exporter'}
三台机器 5分钟内负载
```

```javascript
(1 - (node_memory_MemAvailable_bytes{job='kubernetes-node-exporter'} / node_memory_MemTotal_bytes{job='kubernetes-node-exporter'}))
三台机器 内存使用率
```

```javascript
(1 - node_filesystem_avail_bytes{job='kubernetes-node-exporter',fstype=~"ext.*|xfs",mountpoint ="/"} / node_filesystem_size_bytes{job='kubernetes-node-exporter',fstype=~"ext.*|xfs",mountpoint ="/"})
三台机器 主分区下磁盘使用率
```

```javascript
max by (instance) (irate(node_disk_read_bytes_total{job='kubernetes-node-exporter'}[5m])) / (1024)
三台机器 5分钟内磁盘设备的最大读取速率，单位是MB/s
```

```javascript
max by (instance) (irate(node_disk_written_bytes_total{job='kubernetes-node-exporter'}[5m])) / (1024)
三台机器 5分钟内磁盘设备的最大写入速率，单位是MB/s
```

```javascript
max by (instance) (irate(node_network_receive_bytes_total{job='kubernetes-node-exporter'}[5m])) / (1024)
三台机器 5分钟内网络最大下载速率，单位是MB/s
```

```javascript
max by (instance) (irate(node_network_transmit_bytes_total{job='kubernetes-node-exporter'}[5m])) / (1024)
三台机器 5分钟内网络最大上传速率，单位是MB/s
```

```javascript
(1 - node_filesystem_files_free{job='kubernetes-node-exporter',fstype=~"ext4|xfs",mountpoint="/"} / node_filesystem_files{job='kubernetes-node-exporter',fstype=~"ext4|xfs",mountpoint="/"})
三台机器 主分区下文件控制块(inode)使用率
```

```javascript
(time() - node_boot_time_seconds{job='kubernetes-node-exporter'}) / 3600
三台机器 系统运行时间，单位是h
```

```javascript
node_procs_running{job='kubernetes-node-exporter'}
三台机器 当前运行队列的任务的数量
```

```javascript
node_procs_blocked{job='kubernetes-node-exporter'}
三台机器 当前被阻塞的任务的数量
```

> container相关查询（还没写）加入指定字段`namespace=''`即可指定查询的对象此项指标（和job放一个大括号里就行，用逗号分隔），比如`openfaas-fn`就是指openfaas的函数对应的指标。
>
> <img src="%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5.assets/image-20220802100127186.png" alt="image-20220802100127186" style="zoom:50%;" />
>
> <img src="%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5.assets/image-20220802105502289.png" alt="image-20220802105502289" style="zoom:50%;" />
>
> 
