<h1 align="center">查询语句</h1>

**接口：`10.60.150.24:31119/api/v1/query?query=`**

> 此表中所有查询语句中的`job`指定字段在我们的机器中都是可删除的，因为就这一个job。如果有多个job，那么可以指定其中一个，或加`sum by (job)`字段计算总和。
>
> 此表中所有查询语句的`instance`和`node`字段都是一样的，因为我们的集群中instance和node一对一。一个node代表一个物理机。
>
> 查询语句中container和node不一样，container指pod，即一组协同调度的docker。

```javascript
(1 - avg by (instance) (irate(node_cpu_seconds_total{job='kubernetes-node-exporter',mode="idle"}[5m])))
三台机器 CPU使用率
```

```json
// 数据模式如下：
{
    "status": "success",
    "data": {
        "resultType": "vector",
        "result": [
            {
                "metric": {
                    "instance": "vm-2c4g-node5"
                },
                "value": [
                    1659414887.464,
                    "0.04699999999914628"
                ]
            },
            {
                "metric": {
                    "instance": "vm-2c4g-node6"
                },
                "value": [
                    1659414887.464,
                    "0.054333333333488554"
                ]
            },
            {
                "metric": {
                    "instance": "vm-8c16g-node10"
                },
                "value": [
                    1659414887.464,
                    "0.03008333333321689"
                ]
            }
        ]
    }
}
```



```javascript
node_load1{job='kubernetes-node-exporter'}
三台机器 1分钟内负载
node_load5{job='kubernetes-node-exporter'}
三台机器 5分钟内负载
```

```json
// 数据模式如下：
{
    "status": "success",
    "data": {
        "resultType": "vector",
        "result": [
            {
                "metric": {
                    "__name__": "node_load5",
                    "beta_kubernetes_io_arch": "amd64",
                    "beta_kubernetes_io_os": "linux",
                    "instance": "vm-2c4g-node5",
                    "ip": "10.60.150.55",
                    "job": "kubernetes-node-exporter",
                    "kubernetes_io_arch": "amd64",
                    "kubernetes_io_hostname": "vm-2c4g-node5",
                    "kubernetes_io_os": "linux",
                    "node": "vm-2c4g-node5"
                },
                "value": [
                    1659414937.233,
                    "0.12"
                ]
            },
            {
                "metric": {
                    "__name__": "node_load5",
                    "beta_kubernetes_io_arch": "amd64",
                    "beta_kubernetes_io_os": "linux",
                    "instance": "vm-2c4g-node6",
                    "ip": "10.60.150.54",
                    "job": "kubernetes-node-exporter",
                    "kubernetes_io_arch": "amd64",
                    "kubernetes_io_hostname": "vm-2c4g-node6",
                    "kubernetes_io_os": "linux",
                    "node": "vm-2c4g-node6"
                },
                "value": [
                    1659414937.233,
                    "0.06"
                ]
            },
            {
                "metric": {
                    "__name__": "node_load5",
                    "beta_kubernetes_io_arch": "amd64",
                    "beta_kubernetes_io_os": "linux",
                    "instance": "vm-8c16g-node10",
                    "ip": "10.60.150.24",
                    "job": "kubernetes-node-exporter",
                    "kubernetes_io_arch": "amd64",
                    "kubernetes_io_hostname": "vm-8c16g-node10",
                    "kubernetes_io_os": "linux",
                    "node": "vm-8c16g-node10"
                },
                "value": [
                    1659414937.233,
                    "0.25"
                ]
            }
        ]
    }
}
```



```javascript
(1 - (node_memory_MemAvailable_bytes{job='kubernetes-node-exporter'} / node_memory_MemTotal_bytes{job='kubernetes-node-exporter'}))
三台机器 内存使用率
```

```json
// 数据模式如下：
{
    "status": "success",
    "data": {
        "resultType": "vector",
        "result": [
            {
                "metric": {
                    "beta_kubernetes_io_arch": "amd64",
                    "beta_kubernetes_io_os": "linux",
                    "instance": "vm-2c4g-node5",
                    "ip": "10.60.150.55",
                    "job": "kubernetes-node-exporter",
                    "kubernetes_io_arch": "amd64",
                    "kubernetes_io_hostname": "vm-2c4g-node5",
                    "kubernetes_io_os": "linux",
                    "node": "vm-2c4g-node5"
                },
                "value": [
                    1659415081.518,
                    "0.406556707916659"
                ]
            },
            {
                "metric": {
                    "beta_kubernetes_io_arch": "amd64",
                    "beta_kubernetes_io_os": "linux",
                    "instance": "vm-2c4g-node6",
                    "ip": "10.60.150.54",
                    "job": "kubernetes-node-exporter",
                    "kubernetes_io_arch": "amd64",
                    "kubernetes_io_hostname": "vm-2c4g-node6",
                    "kubernetes_io_os": "linux",
                    "node": "vm-2c4g-node6"
                },
                "value": [
                    1659415081.518,
                    "0.37334025986876684"
                ]
            },
            {
                "metric": {
                    "beta_kubernetes_io_arch": "amd64",
                    "beta_kubernetes_io_os": "linux",
                    "instance": "vm-8c16g-node10",
                    "ip": "10.60.150.24",
                    "job": "kubernetes-node-exporter",
                    "kubernetes_io_arch": "amd64",
                    "kubernetes_io_hostname": "vm-8c16g-node10",
                    "kubernetes_io_os": "linux",
                    "node": "vm-8c16g-node10"
                },
                "value": [
                    1659415081.518,
                    "0.20121913882704856"
                ]
            }
        ]
    }
}
```



```javascript
(1 - node_filesystem_avail_bytes{job='kubernetes-node-exporter',fstype=~"ext.*|xfs",mountpoint ="/"} / node_filesystem_size_bytes{job='kubernetes-node-exporter',fstype=~"ext.*|xfs",mountpoint ="/"})
三台机器 主分区下磁盘使用率
```

```json
// 数据模式如下：
{
    "status": "success",
    "data": {
        "resultType": "vector",
        "result": [
            {
                "metric": {
                    "beta_kubernetes_io_arch": "amd64",
                    "beta_kubernetes_io_os": "linux",
                    "device": "/dev/mapper/centos-root",
                    "fstype": "xfs",
                    "instance": "vm-2c4g-node5",
                    "ip": "10.60.150.55",
                    "job": "kubernetes-node-exporter",
                    "kubernetes_io_arch": "amd64",
                    "kubernetes_io_hostname": "vm-2c4g-node5",
                    "kubernetes_io_os": "linux",
                    "mountpoint": "/",
                    "node": "vm-2c4g-node5"
                },
                "value": [
                    1659415116.663,
                    "0.26621292021149645"
                ]
            },
            {
                "metric": {
                    "beta_kubernetes_io_arch": "amd64",
                    "beta_kubernetes_io_os": "linux",
                    "device": "/dev/mapper/centos-root",
                    "fstype": "xfs",
                    "instance": "vm-2c4g-node6",
                    "ip": "10.60.150.54",
                    "job": "kubernetes-node-exporter",
                    "kubernetes_io_arch": "amd64",
                    "kubernetes_io_hostname": "vm-2c4g-node6",
                    "kubernetes_io_os": "linux",
                    "mountpoint": "/",
                    "node": "vm-2c4g-node6"
                },
                "value": [
                    1659415116.663,
                    "0.25162750607905926"
                ]
            },
            {
                "metric": {
                    "beta_kubernetes_io_arch": "amd64",
                    "beta_kubernetes_io_os": "linux",
                    "device": "/dev/mapper/centos-root",
                    "fstype": "xfs",
                    "instance": "vm-8c16g-node10",
                    "ip": "10.60.150.24",
                    "job": "kubernetes-node-exporter",
                    "kubernetes_io_arch": "amd64",
                    "kubernetes_io_hostname": "vm-8c16g-node10",
                    "kubernetes_io_os": "linux",
                    "mountpoint": "/",
                    "node": "vm-8c16g-node10"
                },
                "value": [
                    1659415116.663,
                    "0.29096733610860237"
                ]
            }
        ]
    }
}
```



```javascript
max by (instance) (irate(node_disk_read_bytes_total{job='kubernetes-node-exporter'}[5m])) / (1024)
三台机器 5分钟内磁盘设备的最大读取速率，单位是MB/s
```

```json
// 数据模式如下：
{
    "status": "success",
    "data": {
        "resultType": "vector",
        "result": [
            {
                "metric": {
                    "instance": "vm-2c4g-node5"
                },
                "value": [
                    1659415150.388,
                    "0"
                ]
            },
            {
                "metric": {
                    "instance": "vm-2c4g-node6"
                },
                "value": [
                    1659415150.388,
                    "0"
                ]
            },
            {
                "metric": {
                    "instance": "vm-8c16g-node10"
                },
                "value": [
                    1659415150.388,
                    "0"
                ]
            }
        ]
    }
}
```



```javascript
max by (instance) (irate(node_disk_written_bytes_total{job='kubernetes-node-exporter'}[5m])) / (1024)
三台机器 5分钟内磁盘设备的最大写入速率，单位是MB/s
```

```json
// 数据模式如下：
{
    "status": "success",
    "data": {
        "resultType": "vector",
        "result": [
            {
                "metric": {
                    "instance": "vm-2c4g-node5"
                },
                "value": [
                    1659415194.524,
                    "14.8"
                ]
            },
            {
                "metric": {
                    "instance": "vm-2c4g-node6"
                },
                "value": [
                    1659415194.524,
                    "1.6"
                ]
            },
            {
                "metric": {
                    "instance": "vm-8c16g-node10"
                },
                "value": [
                    1659415194.524,
                    "26.766666666666666"
                ]
            }
        ]
    }
}
```



```javascript
max by (instance) (irate(node_network_receive_bytes_total{job='kubernetes-node-exporter'}[5m])) / (1024)
三台机器 5分钟内网络最大下载速率，单位是MB/s
```

```json
// 数据模式如下：
{
    "status": "success",
    "data": {
        "resultType": "vector",
        "result": [
            {
                "metric": {
                    "instance": "vm-2c4g-node6"
                },
                "value": [
                    1659415218.695,
                    "19.875520833333333"
                ]
            },
            {
                "metric": {
                    "instance": "vm-8c16g-node10"
                },
                "value": [
                    1659415218.695,
                    "26.4544921875"
                ]
            },
            {
                "metric": {
                    "instance": "vm-2c4g-node5"
                },
                "value": [
                    1659415218.695,
                    "30.569661458333332"
                ]
            }
        ]
    }
}
```



```javascript
max by (instance) (irate(node_network_transmit_bytes_total{job='kubernetes-node-exporter'}[5m])) / (1024)
三台机器 5分钟内网络最大上传速率，单位是MB/s
```

```json
// 数据模式如下：
{
    "status": "success",
    "data": {
        "resultType": "vector",
        "result": [
            {
                "metric": {
                    "instance": "vm-2c4g-node6"
                },
                "value": [
                    1659415259.415,
                    "23.443294270833334"
                ]
            },
            {
                "metric": {
                    "instance": "vm-8c16g-node10"
                },
                "value": [
                    1659415259.415,
                    "46.526953125"
                ]
            },
            {
                "metric": {
                    "instance": "vm-2c4g-node5"
                },
                "value": [
                    1659415259.415,
                    "30.1130859375"
                ]
            }
        ]
    }
}
```



```javascript
(1 - node_filesystem_files_free{job='kubernetes-node-exporter',fstype=~"ext4|xfs",mountpoint="/"} / node_filesystem_files{job='kubernetes-node-exporter',fstype=~"ext4|xfs",mountpoint="/"})
三台机器 主分区下文件控制块(inode)使用率
```

```json
// 数据模式如下：
{
    "status": "success",
    "data": {
        "resultType": "vector",
        "result": [
            {
                "metric": {
                    "beta_kubernetes_io_arch": "amd64",
                    "beta_kubernetes_io_os": "linux",
                    "device": "/dev/mapper/centos-root",
                    "fstype": "xfs",
                    "instance": "vm-2c4g-node5",
                    "ip": "10.60.150.55",
                    "job": "kubernetes-node-exporter",
                    "kubernetes_io_arch": "amd64",
                    "kubernetes_io_hostname": "vm-2c4g-node5",
                    "kubernetes_io_os": "linux",
                    "mountpoint": "/",
                    "node": "vm-2c4g-node5"
                },
                "value": [
                    1659415287.237,
                    "0.005195578245306365"
                ]
            },
            {
                "metric": {
                    "beta_kubernetes_io_arch": "amd64",
                    "beta_kubernetes_io_os": "linux",
                    "device": "/dev/mapper/centos-root",
                    "fstype": "xfs",
                    "instance": "vm-2c4g-node6",
                    "ip": "10.60.150.54",
                    "job": "kubernetes-node-exporter",
                    "kubernetes_io_arch": "amd64",
                    "kubernetes_io_hostname": "vm-2c4g-node6",
                    "kubernetes_io_os": "linux",
                    "mountpoint": "/",
                    "node": "vm-2c4g-node6"
                },
                "value": [
                    1659415287.237,
                    "0.005499691817846264"
                ]
            },
            {
                "metric": {
                    "beta_kubernetes_io_arch": "amd64",
                    "beta_kubernetes_io_os": "linux",
                    "device": "/dev/mapper/centos-root",
                    "fstype": "xfs",
                    "instance": "vm-8c16g-node10",
                    "ip": "10.60.150.24",
                    "job": "kubernetes-node-exporter",
                    "kubernetes_io_arch": "amd64",
                    "kubernetes_io_hostname": "vm-8c16g-node10",
                    "kubernetes_io_os": "linux",
                    "mountpoint": "/",
                    "node": "vm-8c16g-node10"
                },
                "value": [
                    1659415287.237,
                    "0.006194080183393069"
                ]
            }
        ]
    }
}
```



```javascript
(time() - node_boot_time_seconds{job='kubernetes-node-exporter'}) / 3600
三台机器 系统运行时间，单位是h
```

```json
// 数据模式如下：
{
    "status": "success",
    "data": {
        "resultType": "vector",
        "result": [
            {
                "metric": {
                    "beta_kubernetes_io_arch": "amd64",
                    "beta_kubernetes_io_os": "linux",
                    "instance": "vm-2c4g-node5",
                    "ip": "10.60.150.55",
                    "job": "kubernetes-node-exporter",
                    "kubernetes_io_arch": "amd64",
                    "kubernetes_io_hostname": "vm-2c4g-node5",
                    "kubernetes_io_os": "linux",
                    "node": "vm-2c4g-node5"
                },
                "value": [
                    1659415317.467,
                    "116.79235194444657"
                ]
            },
            {
                "metric": {
                    "beta_kubernetes_io_arch": "amd64",
                    "beta_kubernetes_io_os": "linux",
                    "instance": "vm-2c4g-node6",
                    "ip": "10.60.150.54",
                    "job": "kubernetes-node-exporter",
                    "kubernetes_io_arch": "amd64",
                    "kubernetes_io_hostname": "vm-2c4g-node6",
                    "kubernetes_io_os": "linux",
                    "node": "vm-2c4g-node6"
                },
                "value": [
                    1659415317.467,
                    "116.79346305555768"
                ]
            },
            {
                "metric": {
                    "beta_kubernetes_io_arch": "amd64",
                    "beta_kubernetes_io_os": "linux",
                    "instance": "vm-8c16g-node10",
                    "ip": "10.60.150.24",
                    "job": "kubernetes-node-exporter",
                    "kubernetes_io_arch": "amd64",
                    "kubernetes_io_hostname": "vm-8c16g-node10",
                    "kubernetes_io_os": "linux",
                    "node": "vm-8c16g-node10"
                },
                "value": [
                    1659415317.467,
                    "116.80151861111322"
                ]
            }
        ]
    }
}
```



```javascript
node_procs_running{job='kubernetes-node-exporter'}
三台机器 当前运行队列的任务的数量
```

```json
// 数据模式如下：
{
    "status": "success",
    "data": {
        "resultType": "vector",
        "result": [
            {
                "metric": {
                    "__name__": "node_procs_running",
                    "beta_kubernetes_io_arch": "amd64",
                    "beta_kubernetes_io_os": "linux",
                    "instance": "vm-2c4g-node5",
                    "ip": "10.60.150.55",
                    "job": "kubernetes-node-exporter",
                    "kubernetes_io_arch": "amd64",
                    "kubernetes_io_hostname": "vm-2c4g-node5",
                    "kubernetes_io_os": "linux",
                    "node": "vm-2c4g-node5"
                },
                "value": [
                    1659415345.801,
                    "2"
                ]
            },
            {
                "metric": {
                    "__name__": "node_procs_running",
                    "beta_kubernetes_io_arch": "amd64",
                    "beta_kubernetes_io_os": "linux",
                    "instance": "vm-2c4g-node6",
                    "ip": "10.60.150.54",
                    "job": "kubernetes-node-exporter",
                    "kubernetes_io_arch": "amd64",
                    "kubernetes_io_hostname": "vm-2c4g-node6",
                    "kubernetes_io_os": "linux",
                    "node": "vm-2c4g-node6"
                },
                "value": [
                    1659415345.801,
                    "5"
                ]
            },
            {
                "metric": {
                    "__name__": "node_procs_running",
                    "beta_kubernetes_io_arch": "amd64",
                    "beta_kubernetes_io_os": "linux",
                    "instance": "vm-8c16g-node10",
                    "ip": "10.60.150.24",
                    "job": "kubernetes-node-exporter",
                    "kubernetes_io_arch": "amd64",
                    "kubernetes_io_hostname": "vm-8c16g-node10",
                    "kubernetes_io_os": "linux",
                    "node": "vm-8c16g-node10"
                },
                "value": [
                    1659415345.801,
                    "8"
                ]
            }
        ]
    }
}
```



```javascript
node_procs_blocked{job='kubernetes-node-exporter'}
三台机器 当前被阻塞的任务的数量
```

```json
// 数据模式如下：
{
    "status": "success",
    "data": {
        "resultType": "vector",
        "result": [
            {
                "metric": {
                    "__name__": "node_procs_blocked",
                    "beta_kubernetes_io_arch": "amd64",
                    "beta_kubernetes_io_os": "linux",
                    "instance": "vm-2c4g-node5",
                    "ip": "10.60.150.55",
                    "job": "kubernetes-node-exporter",
                    "kubernetes_io_arch": "amd64",
                    "kubernetes_io_hostname": "vm-2c4g-node5",
                    "kubernetes_io_os": "linux",
                    "node": "vm-2c4g-node5"
                },
                "value": [
                    1659415395.197,
                    "0"
                ]
            },
            {
                "metric": {
                    "__name__": "node_procs_blocked",
                    "beta_kubernetes_io_arch": "amd64",
                    "beta_kubernetes_io_os": "linux",
                    "instance": "vm-2c4g-node6",
                    "ip": "10.60.150.54",
                    "job": "kubernetes-node-exporter",
                    "kubernetes_io_arch": "amd64",
                    "kubernetes_io_hostname": "vm-2c4g-node6",
                    "kubernetes_io_os": "linux",
                    "node": "vm-2c4g-node6"
                },
                "value": [
                    1659415395.197,
                    "0"
                ]
            },
            {
                "metric": {
                    "__name__": "node_procs_blocked",
                    "beta_kubernetes_io_arch": "amd64",
                    "beta_kubernetes_io_os": "linux",
                    "instance": "vm-8c16g-node10",
                    "ip": "10.60.150.24",
                    "job": "kubernetes-node-exporter",
                    "kubernetes_io_arch": "amd64",
                    "kubernetes_io_hostname": "vm-8c16g-node10",
                    "kubernetes_io_os": "linux",
                    "node": "vm-8c16g-node10"
                },
                "value": [
                    1659415395.197,
                    "0"
                ]
            }
        ]
    }
}
```



> container相关查询加入指定字段`namespace=''`即可指定查询的对象此项指标（和job放一个大括号里就行，用逗号分隔），比如`openfaas-fn`就是指openfaas的函数对应的指标。
>
> <img src="%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5.assets/image-20220802100127186.png" alt="image-20220802100127186" style="zoom:50%;" />
>
> <img src="%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5.assets/image-20220802105502289.png" alt="image-20220802105502289" style="zoom:50%;" />
>
> 
